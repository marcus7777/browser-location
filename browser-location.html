<link rel="import" href="../paper-button/paper-button.html">
<link rel="import" href="../polymer/polymer.html">
<!--
  `<browser-location></browser-location>` Asks the browser of your current location
  @demo demo.html
-->
<dom-module id="browser-location">
  <template>
    <paper-button on-tap="getLocation">[[text]]</paper-button>
  </template>
</dom-module>
<script>
  Polymer({
    is: "browser-location",
    properties:{
      latitude:{
        notify:true,
      },
      longitude:{
        notify:true,
      },
      text:{
        value: "Share my location"
      },
      onceApproved:{
        value: "âŠ•"
      },
    },
    setLatLong: function(position){
      this.latitude = position.coords.latitude
      this.longitude = position.coords.longitude
      this.text = this.onceApproved
    },
    getLocation: function(){
      if (navigator.geolocation) {
        navigator.geolocation.getCurrentPosition(this.setLatLong);
      } else {
        that.text = "Geolocation is not supported by this browser."
      }
    },
    ready: function(){
      var that = this
      if (navigator.permissions) {
        navigator.permissions.query({name:'geolocation'}).then(function(permission){
          // is geolocation granted?
          if (permission.state === "granted") {
            if (!that.latitude) {
              that.getLocation()
            }
          }
        })
      }
    },
  })
</script>
